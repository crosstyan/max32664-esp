<!-- image -->

# Measuring SpO2 and Heart Rate Using the MAX32664C - A Quick Start Guide

## Abstract

The MAX32664C is a variant of the MAX32664 sensor-hub family, which is specifically targeted for measurement of SpO2 and heart rate. Combined with the MAX86141/MAXM86161 optical sensor and a 3-axis accelerometer, it provides the sensor's raw data, as well as calculated SpO2 and heart-rate data, to a host device through its I2C slave interface. This document provides step-by-step instructions that enable a user to communicate with the MAX32664C and to calibrate, configure, and receive measurement and monitoring data.

Table of Contents

| Introduction ...................................................................................................................................  4                                                            |
| -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 1 Architecture  ................................................................................................................................  5                                                            |
| 1.1 Communicating with the MAX32664C  .................................................................................  7                                                                                     |
| 1.2 Power-Saving Considerations .............................................................................................  8                                                                               |
| 1.2.1 Report Rate ..................................................................................................................  8                                                                        |
| 1.2.2 Polling Period  ................................................................................................................  8                                                                      |
| 1.2.3 Report Content .............................................................................................................  8                                                                          |
| 1.3 Accelerometer .....................................................................................................................  8                                                                     |
| 2 SpO2 Calibration  ......................................................................................................................  10                                                                 |
| 3 Measuring SpO2  and Heart Rate on Wrist-SpO2  and WHRM ..............................................  13                                                                                                    |
| 3.1 Raw Data Collection Mode  ................................................................................................  13                                                                             |
| 3.2 AGC Mode  .........................................................................................................................  14                                                                    |
| 3.3 AEC Mode .........................................................................................................................  20                                                                     |
| 3.4 Power-Saving Mode ..........................................................................................................  21                                                                           |
| 4 Configurations and Settings  .....................................................................................................  21                                                                       |
| 6 Power Consumption Estimate  ..................................................................................................  28                                                                           |
| Revision History ..........................................................................................................................  29                                                                |
| List of Figures                                                                                                                                                                                                |
| communicate with the sensor (such as the MAX86141).  ..............................................................  6                                                                                         |
| Figure 2. Architecture diagram for health-sensing applications using an I2C interface to  communicate with the sensor (such as the MAXM86161).  ...........................................................  6 |
| Figure 3. Host interface signaling. ................................................................................................  7                                                                        |

## List of Tables

| Table 1. Read Status Byte Value  ..................................................................................................  7                                                                                         |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| Table 2. Host-Side Accelerometer-Sending Data to the MAX32664C .......................................  9                                                                                                                      |
| Table 3. Host Commands-SpO2 in Calibration Mode ...............................................................  11                                                                                                            |
| Table 4. Format of Received Samples-SpO2 in Calibration Mode  ............................................  12                                                                                                                 |
| Table 5. Host Commands-Raw Data Mode  ..............................................................................  13                                                                                                       |
| Table 6. Format of Received Samples-Raw Data Mode ..........................................................  14                                                                                                               |
| Table 7. Host Commands-AGC Mode  ......................................................................................  15                                                                                                    |
| Table 8. Format of Received Samples-Normal Algorithm Report ............................................  16                                                                                                                   |
| Table 9. Format of Received Samples-Extended Algorithm Report  .........................................  17                                                                                                                   |
| Table 10. Host Commands-AEC Mode ....................................................................................  20                                                                                                      |
| Table 11. Algorithm Configuration and Settings .........................................................................  21                                                                                                   |
| Table 12. Frequently Used Sensor Hub Settings and Commands .............................................  24                                                                                                                   |
| Table 13. Host Commands to Enable/Disable Wake Up on Motion Configuration of Sensor Hub  Accelerometer for Off-Skin State ................................................................................................  27 |
| Table 14. Comparison of Active and Deep Sleep Power-Single Supply (VDD Only)  .................  28                                                                                                                            |
| Table 15. Comparison of Active and Deep Sleep Power-Dual Supply (VDD and VCORE)  ...........  28                                                                                                                               |
| Table 16. Estimated Power Consumption for the MAX32664C ..................................................  28                                                                                                                 |

## Introduction

The MAX32664C is a variant of the MAX32664 sensor-hub family that enables users to capture raw data, as well as calculated SpO2  and heart-rate data. The firmware includes the drivers and algorithm that are required to interface with a sensor device, such as the MAX86141, through the SPI port, or the MAXM86161 through first I2C port as master. The second I2C interface is slave and dedicated to establishing communication with a host microcontroller.

In order to properly capture and calculate the data, this solution requires an accelerometer. The MAX32664C firmware includes the required drivers for the Kionix ®  KX122 accelerometer, which is  wired  together  with  the  sensor  to  the  same  SPI  or  I2C  port.  Alternatively,  a  host-side accelerometer can be used. In this case, the sampled accelerometer data must be periodically reported  to  the  MAX32664C  by  the  host  microcontroller  using  commands  described  in  this application note.

This document provides the instructions necessary to create a solution with the MAX32664C based on the MAXREFDES102# reference design.

NOTE: The instructions in this document are compatible with the MAX32664C firmware version 30.9.x (MAX86141), or 32.9.x (MAXM86161) and later. If you are using older firmware, make sure to upgrade the firmware.

## 1 Architecture

A  typical  health-sensing  design  includes  a  host  microcontroller  that  communicates  with  the MAX32664C through the I2C bus. Two GPIO pins are needed to control the reset and the startup in Application or Bootloader mode through the RSTN and multifunction input/output (MFIO) pins.

To enter Bootloader mode:

- Set the RSTN pin to low for 10ms.
- While RSTN is low, set the MFIO pin to low. (The MFIO pin should be set to low at least 1ms before the RSTN pin is set to high.)
- After the 10ms has elapsed, set the RSTN pin to high.
- After an additional 50ms has elapsed, the MAX32664 is in Bootloader mode.

To enter Application mode:

- Set the RSTN pin to low for 10ms.
- While RSTN is low, set the MFIO pin to high.
- After the 10ms has elapsed, set the RSTN pin to high. (The MFIO pin should be set to high at least 1ms before the RSTN pin is set to high.)
- After  an  additional  50ms  has  elapsed,  the  MAX32664  is  in  Application  mode  and  the application performs its initialization of the application software.
- After approximately 1 second from when the RSTN pin was set to high, the application completes the initialization and the device is ready to accept I2C commands.

The MFIO pin (normally set to high) is used in Application mode to wake up the MAX32664C from its Deep Sleep mode prior to any I2C communication. The MAX32664C interfaces to the optical sensor through either the SPI bus (such as the MAX86141), or I2C bus (such as the MAXM86161), subject to firmware support of the sensor.

An  accelerometer  is  mandatory  for  heart-rate  monitoring.  A  KX122  accelerometer  can  be connected directly to the MAX32664C. The interrupt line of the accelerometer is recommended to be connected to the MAX32664C to support motion detection power saving. Alternatively, an external 3-axis host-side accelerometer can be used. In this case, the host needs to periodically provide  accelerometer  readings  to  the  sensor  hub  using  the  commands  provided  in  this document. For more information, see the MAX32664 User Guide .

The optical sensor utilizes green and/or red and infrared (IR) LEDs to transmit pulses and one or more photodiodes (PD) to collect reflected or residual light. By default, the heart-rate monitoring algorithm uses a green LED (LED1) and two PDs (PD1 and PD2). The SpO2 employs one IR LED (LED2) and one red LED (LED3) with one PD (PD1).

Note:  If  a  configuration  other  than  default  is  used,  the  user  should  change  the  LED  and  PD configuration for heart-rate and SpO2  algorithms using the provided commands (see Table 11 ) prior to enabling the algorithm.

Figure 1. Architecture diagram for health-sensing applications using an SPI interface to communicate with the sensor (such as the MAX86141).

<!-- image -->

Figure 2. Architecture diagram for health-sensing applications using an I2C interface to communicate with the sensor (such as the MAXM86161).

<!-- image -->

## 1.1 Communicating with the MAX32664C

A  host  uses  the  I2C  bus  to  communicate  with  the  MAX32664C  (slave)  using  a  series  of commands. A generic write command includes the following fields:

Slave\_WriteAddress(1 byte)|Command\_Family(1 byte)|Command\_Index(1 byte)|Value(multiple bytes)

A generic response includes the following fields:

Slave\_ReadAddress(1 byte)|Status(1 byte)|Value (multiple bytes)

Slave\_WriteAddress and Slave\_ReadAddress are set to 0xAA and 0xAB, respectively.

The read status byte is an indicator of success (0x00) or failure, as shown in Table 1 .

Table 1. Read Status Byte Value

| STATUS BYTE  VALUE | DESCRIPTION                                                                   |
| ------------------ | ----------------------------------------------------------------------------- |
| 0x00               | The write transaction was successful.                                         |
| 0x01               | Illegal Family Byte and/or Command Byte was used.                             |
| 0x02               | This function is not implemented.                                             |
| 0x03               | Incorrect number of bytes sent for the requested Family Byte.                 |
| 0x04               | Illegal configuration value was attempted to be set.                          |
| 0x05               | Incorrect mode specified. (In bootloader: Device is busy. Try again)          |
| 0x80               | General error while receiving/flashing a page during the bootloader sequence. |
| 0x81               | Checksum error while decrypting/checking page data.                           |
| 0x82               | Authorization error.                                                          |
| 0x83               | Application not valid.                                                        |
| 0xFE               | Device is busy. Try again.                                                    |
| 0xFF               | Unknown error.                                                                |

Normally, when MAX32664C is idle, it switches to Deep Sleep mode to save power. An external interrupt-like sensor, host MFIO, or RTC alarm forces the MAX32664C to wake up.

In particular, the host is required to wake up the MAX32664C prior to any I2C communication by:

- · Setting the MFIO pin to low at least 250 μ s before the beginning of an I2C transaction to make sure the MAX32664C is awake.
- · Keeping the MFIO pin low during the I2C transaction to make sure the MAX32664C will not switch to Deep Sleep mode.
- · Setting  MFIO to high after the end of I2C  communication to allow the MAX32664C to switch back to Deep Sleep mode.

Figure 3. Host interface signaling.

<!-- image -->

This  document  provides  examples  of  commands  for  establishing  communication  with  the MAX32664C. For a complete list of commands and instructions for the I2C interface, see the MAX32664 User Guide .

## 1.2 Power-Saving Considerations

## 1.2.1 Report Rate

The  MAX32664C  goes  into  deep  sleep  in  Idle  mode  and  wakes  up  on  internal  or  external interrupts. To maximize the benefits of low power, the host may configure the report period of the algorithm to a longer time. In this case, the report is generated less frequently.

This report rate is configured through an I2C command, as shown in Table 12 .

## 1.2.2 Polling Period

The host is required to regularly poll the MAX32664C to read available measurement data. The polling period depends on the rate that the MAX32664C report is generated. By reducing the report  period,  polling  is  needed  less  often  and  hence  the  number  of  wake-up  events  will  be reduced significantly.

The polling period can be set four to five times the length of the report period to avoid FIFO overflow. In this case, several samples will be read in each polling.

By default, the report rate is set to one per sample, which translates to 40ms. In this case, a 200ms polling period is suggested.

## 1.2.3 Report Content

If  the  sensor  data  such  as  accelerometer  and  photoplethysmogram  (PPG)  signals  are  not required, the host may  choose  to  request  only  algorithm data. This reduces  the I2C communication time and affects power consumption. This is performed by configuring the output mode to Algorithm Only.

This output mode is configured through an I2C command, as shown in Table 12 .

## 1.3 Accelerometer

The MAX32664C requires accelerometer data to function properly. In particular, an accelerometer is mandatory for a heart-rate monitor to be able to compensate for the user's motion. Otherwise, the reported heart rate will not be correct during movement.

SpO2 calculation requires a resting condition, and the algorithm uses accelerometer data to detect excessive motion. In such a condition, computation is paused, and the user is informed with a motion flag.

A sensor hub accelerometer can be integrated through the SPI port of the MAX32664C. In this case,  the  required  driver  for  KX122  is  already  included.  The  user  only  needs  to  follow  the reference schematics to connect the accelerometer and enable it before starting the algorithm, as described later in this document. Normally, the accelerometer is polled to collect samples. The interrupt line is only needed if the SCD-based power saving procedure is implemented in the host.

Alternatively, a host-side accelerometer can be used. However, this option requires strict timing synchronization between the sampled accelerometer data and PPG samples of ±40ms or less. In order to use the host-side accelerometer:

- 1. The host should start the accelerometer just before enabling the algorithm to maximize the  initial  synchronization  between  the  PPG  and  accelerometer  samples.  However, accelerometer  samples  collected  prior  to  receiving  the  confirmation  of  the  algorithm enable I2C command should be discarded.
- 2. The host is required to use a 3-axis accelerometer at a 25Hz sampling rate. If a higher sampling rate is chosen, samples should be decimated to be synchronized with a 40ms PPG sampling time.
- 3. The host must queue five accelerometer samples and feed them at the same time to the MAX32664C using the  commands  shown  in Table  2 .  The  period  of  feeding  samples should be 200ms. This is the longest delay that the MAX32664C can tolerate to receive accelerometer samples.

Because the sensor and the host accelerometer use different clock sources, exact synchronization  between  them  is  not  possible.  The  MAX32664C  internally  decimates  or interpolates accelerometer samples as needed to compensate a drift.

Table 2. Host-Side Accelerometer-Sending Data to the MAX32664C

| HOST COMMAND  (HEX)                              | DESCRIPTION                                                                                                                 | MAX32664  RESPONSE  (HEX) | DESCRIPTION                                             |
| ------------------------------------------------ | --------------------------------------------------------------------------------------------------------------------------- | ------------------------- | ------------------------------------------------------- |
| AA 44 04 01 01                                   | Enable the host  accelerometer.                                                                                             | AB 00                     | Success                                                 |
| AA 13 00 04                                      | Read the sensor sample  size for the accelerometer  (optional).                                                             | AB 00 06                  | Success; 6 is the  number of bytes per  samples in FIFO |
| -                                                | The following should be executed periodically at 200ms:                                                                     | -                         | -                                                       |
| AA 14 00 [Sample 1  values] … [Sample N  values] | Write data to the input FIFO  of the sensor hub.  Each sample has three 2- byte integer values for X, Y,  and Z in milli-g. | AB 00                     | Success                                                 |
| AA 00 00                                         | Read the sensor hub status.                                                                                                 | AB 00 00                  | Success; sensor hub  not busy                           |

## 2 SpO2 Calibration

Due  to  variations  in  the  physical  design  and  optical  shield  of  the  final  product,  a  calibration procedure for SpO2  is required to be performed once in a controlled environment. This procedure is important to ensure the quality of the SpO2  calculation. This step is typically performed in a standard lab with a reference SpO2  device to determine three calibration coefficients: a, b, and c. The details of the calibration procedure are described in the Guidelines for SpO2 Measurement Using the Maxim MAX32664 Sensor Hub application note.

Once three calibrations coefficients are obtained, they need to be loaded to the MAX32664C every time prior to starting the algorithm. But first, they are required to be converted to a 32-bit integer format using the following:

- · Aint32  = round (10 5  x a)
- · Bint32  = round (10 5  x b)
- · Cint32  = round (10 5  x c)

For example, the default measured calibration coefficients are:

- · a = -16.666666
- · b = 8.333333
- · c = 100

They are sent to the MAX32664C in integer format after conversion:

- · Aint32  = round (10 5  x a) = 0xFFE69196
- · Bint32  = round (10 5  x b) = 0x000CB735
- · Cint32  = round (10 5  x c) = 0x00989680

The  calibration  coefficients  may  be  stored  in  the  host  flash  separately  and  loaded  to  the MAX32664C after every reset.

Table 3 shows the sequence of commands for the calibration process. Table 4 shows the format of received samples. Typically, R values are needed for the calibration process, as described in the Guidelines for SpO2 Measurement Using the Maxim MAX32664 Sensor Hub application note.

Table 3. Host Commands-SpO2 in Calibration Mode

|                                                                                                       | #             | HOST COMMAND  (HEX)                                                                             | COMMAND DESCRIPTION                                                                                                                                                                                                                                                          | RESPONSE  (HEX)                                                                                 |
| ----------------------------------------------------------------------------------------------------- | ------------- | ----------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------- |
| Host initializes the MAX32664C in calibration mode and starts the algorithm using following commands: | -             | -                                                                                               | -                                                                                                                                                                                                                                                                            |
|                                                                                                       | 1.1           | AA 10 00 03*                                                                                    | Set the output mode to sensor + algorithm data  (streamed data will include PPG accelerometer and  algorithm data).*                                                                                                                                                         | AB 00                                                                                           |
|                                                                                                       | 1.2           | AA 10 01 01                                                                                     | Set the sensor hub interrupt threshold.                                                                                                                                                                                                                                      | AB 00                                                                                           |
| START ALGORITHM                                                                                       | 1.3           | AA 10 02 01*                                                                                    | Set the report rate to be one report per every sensor  sample.*                                                                                                                                                                                                              | AB 00                                                                                           |
|                                                                                                       | 1.4           | AA 44 04 01 01 (if  host accelerometer  is used)                                                | Enable the host-side accelerometer, if used.  Otherwise, the sensor hub accelerometer is used by  default, and there is no need to enable it.                                                                                                                                | AB 00                                                                                           |
|                                                                                                       | 1.5           | AA 50 07 0A 06                                                                                  | Set the mode to SpO2  Calibration.                                                                                                                                                                                                                                           | AB 00                                                                                           |
|                                                                                                       | 1.6           | Optional: Any command to change the algorithm settings and configurations ( Table 11 ) from the | Optional: Any command to change the algorithm settings and configurations ( Table 11 ) from the                                                                                                                                                                              | Optional: Any command to change the algorithm settings and configurations ( Table 11 ) from the |
|                                                                                                       | 1.7           | AA 52 07 01                                                                                     | default setting should appear here BEFORE enabling the algorithm.  Enable the algorithm; the analog front-end (AFE) and  sensor hub accelerometer will be enabled automatically.                                                                                             | AB 00                                                                                           |
| Host reads samples periodically (repeated as needed):                                                 | -             | -                                                                                               | -                                                                                                                                                                                                                                                                            |
|                                                                                                       | 2.1           | AA 00 00                                                                                        | Read the sensor hub status byte:  Bit 0: Sensor comm error  Bits 1 and 2: Reserved  Bit 3: FIFO filled to threshold (DataRdyInt)  Bit 4: Output FIFO overflow (FifoOutOvrInt)  Bit 5: Input FIFO overflow (FifoInOverInt)  Bit 6: Sensor hub busy (DevBusy)  Bit 7: Reserved | AB 00 08                                                                                        |
| READING SAMPLES                                                                                       | 2.2           | AA 12 00                                                                                        | If DataRdyInt is set, proceed to the next step.  Get the number of samples (nn) in the FIFO.                                                                                                                                                                                 | AB 00 nn                                                                                        |
|                                                                                                       | 2.3           | AA 12 01                                                                                        | Read the data stored in the FIFO; nn samples will be  included. The format of the samples is shown in  Table 4.                                                                                                                                                              | AB 00  data\_for\_  nn\_samples                                                                 |
| STOP                                                                                                  | 3.1  3.2  3.3 | Host ends the procedure:  AA 44 00** 00  AA 44 04 00  AA 52 07 00                               | Disable the AFE (e.g., the MAX86141).**  Disable the accelerometer.  Disable the algorithm.                                                                                                                                                                                  | AB 00  AB 00  AB 00                                                                             |

*The host is required to poll the MAX32664C for an available report. A report is available per every sensor sample. Since the effective sample rate is 25Hz, this means the report will be ready every 40ms. Depending on the output mode, the report may include algorithm and/or sensor data (see section 1.2 and Table 12 ).

Table 4. Format of Received Samples-SpO2 in Calibration Mode

| DATA  SOURCE                    | BYTE  INDEX | DATA ITEM                     | # OF BYTES  (MSB FIRST) | DESCRIPTION                                                                                                                                                                                                                                                                   |
| ------------------------------- | ----------- | ----------------------------- | ----------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| MAX86141  PPG Data  (18 Bytes)* | 0           | PPG1                          | 3                       | N/A                                                                                                                                                                                                                                                                           |
| MAX86141  PPG Data  (18 Bytes)* | 3           | PPG2                          | 3                       | N/A                                                                                                                                                                                                                                                                           |
| MAX86141  PPG Data  (18 Bytes)* | 6           | PPG3                          | 3                       | N/A                                                                                                                                                                                                                                                                           |
| MAX86141  PPG Data  (18 Bytes)* | 9           | PPG4                          | 3                       | N/A                                                                                                                                                                                                                                                                           |
| MAX86141  PPG Data  (18 Bytes)* | 12          | PPG5                          | 3                       | IR LED counter                                                                                                                                                                                                                                                                |
| MAX86141  PPG Data  (18 Bytes)* |             |                               | 3                       |                                                                                                                                                                                                                                                                               |
| MAX86141  PPG Data  (18 Bytes)* | 15          | PPG6                          |                         | Red LED counter                                                                                                                                                                                                                                                               |
| Accelerometer                   | 18          | accelX                        | 2                       | Two's complement. LSB = 0.001g                                                                                                                                                                                                                                                |
| Accelerometer                   | 20          | accelY                        | 2                       | Two's complement. LSB = 0.001g                                                                                                                                                                                                                                                |
| (6 Bytes)*                      | 22          | accelZ                        | 2                       |                                                                                                                                                                                                                                                                               |
| Suite  Algorithm                | 24          | Op mode                       | 1                       | Two's complement. LSB = 0.001g  Current operation mode:  0: Continuous Heart-Rate Monitor (HRM)  and Continuous SpO2   1: Continuous HRM and One-Shot SpO2   2: Continuous HRM  3: Sampled HRM  4: Sampled HRM and One-Shot SpO2   5: Activity Tracking  6: SpO2  Calibration |
| Suite  Algorithm                | 25          | HR                            | 2                       | N/A                                                                                                                                                                                                                                                                           |
| Suite  Algorithm                | 27          | HR confidence                 | 1                       | N/A                                                                                                                                                                                                                                                                           |
| Suite  Algorithm                | 28          | RR                            | 2                       | N/A                                                                                                                                                                                                                                                                           |
| Suite  Algorithm                | 30          | RR confidence                 | 1                       | N/A                                                                                                                                                                                                                                                                           |
| Suite  Algorithm                | 31          | Activity class                | 1                       | N/A                                                                                                                                                                                                                                                                           |
| Suite  Algorithm                | 32          | R                             | 2                       | 1000x calculated R value                                                                                                                                                                                                                                                      |
| Suite  Algorithm                | 34          | SpO2 confidence               | 1  2                    | Calculated confidence in %  N/A                                                                                                                                                                                                                                               |
| Suite  Algorithm                | 35  37      | SpO2  SpO2 % complete         | 1                       | N/A                                                                                                                                                                                                                                                                           |
| Wearable  (20 Bytes)**          | 38          | SpO2 low signal  quality flag | 1                       | Shows the low quality of the PPG signal:  0: Good quality  1: Low quality                                                                                                                                                                                                     |
| Wearable  (20 Bytes)**          | 39          | SpO2 motion flag              |                         |                                                                                                                                                                                                                                                                               |
| Wearable  (20 Bytes)**          |             |                               | 1                       | Shows excessive motion:  0: No motion  1: Excessive motion                                                                                                                                                                                                                    |
| Wearable  (20 Bytes)**          | 40          | SpO2 low PI flag              | 1                       | Shows the low perfusion index (PI) of the  PPG signal:  0: Normal PI  1: Low PI                                                                                                                                                                                               |
| Wearable  (20 Bytes)**          | 41          | SpO2 unreliable R  flag       | 1                       | Shows the reliability of R:  0: Reliable  1: Unreliable                                                                                                                                                                                                                       |
| Wearable  (20 Bytes)**          | 42          | SpO2 state  Skin contact      | 1                       | Reported status of the SpO2  algorithm:  0: LED adjustment  1: Computation  2: Success  3: Timeout  Skin contact state:  0: Undetected                                                                                                                                        |

- *If the output mode includes the sensor.

## 3 Measuring SpO2 and Heart Rate on Wrist-SpO2 and WHRM

## 3.1 Raw Data Collection Mode

For hardware testing purposes, the user may choose to start the MAX32664C to collect raw PPG samples.  In  this  case,  the  host  configures  the  MAX32664C  to  work  in  Raw  Data  mode  (no algorithm) by enabling the accelerometer and the AFE. Table 5 lists the set of commands that are needed to work in this mode. In Raw Data mode, only raw PPG samples and accelerometer data are included in the received samples.

Table 5. Host Commands-Raw Data Mode

|                                                                                                                                                                                      | #                                                                                                                                                                                                                                        | HOST COMMAND  (HEX)                                                                                                                                                                                                                      | COMMAND DESCRIPTION                                                                                                                                                                                                                      | RESPONSE  (HEX)                                                                                                                   |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------- |
| Host initializes the MAX32664C in Raw Data mode using following commands:                                                                                                            | Host initializes the MAX32664C in Raw Data mode using following commands:                                                                                                                                                                | Host initializes the MAX32664C in Raw Data mode using following commands:                                                                                                                                                                | Host initializes the MAX32664C in Raw Data mode using following commands:                                                                                                                                                                | Host initializes the MAX32664C in Raw Data mode using following commands:                                                         |
|                                                                                                                                                                                      | AA 10 00 01*  Set the output mode to Sensor Only.*                                                                                                                                                                                       | AA 10 00 01*  Set the output mode to Sensor Only.*                                                                                                                                                                                       | AA 10 00 01*  Set the output mode to Sensor Only.*                                                                                                                                                                                       | AB 00                                                                                                                             |
|                                                                                                                                                                                      | 1.1  1.2  AA 10 01 01  Set the sensor hub interrupt threshold.                                                                                                                                                                           | 1.1  1.2  AA 10 01 01  Set the sensor hub interrupt threshold.                                                                                                                                                                           | 1.1  1.2  AA 10 01 01  Set the sensor hub interrupt threshold.                                                                                                                                                                           | AB 00                                                                                                                             |
|                                                                                                                                                                                      | 1.3  AA 44 04** 01 00 (if  Enable the accelerometer.                                                                                                                                                                                     | 1.3  AA 44 04** 01 00 (if  Enable the accelerometer.                                                                                                                                                                                     | 1.3  AA 44 04** 01 00 (if  Enable the accelerometer.                                                                                                                                                                                     |                                                                                                                                   |
|                                                                                                                                                                                      | sensor hub  accelerometer is used)                                                                                                                                                                                                       | sensor hub  accelerometer is used)                                                                                                                                                                                                       | sensor hub  accelerometer is used)                                                                                                                                                                                                       | AB 00                                                                                                                             |
|                                                                                                                                                                                      | AA 44 04** 01 01 (if host                                                                                                                                                                                                                | AA 44 04** 01 01 (if host                                                                                                                                                                                                                | AA 44 04** 01 01 (if host                                                                                                                                                                                                                |                                                                                                                                   |
|                                                                                                                                                                                      | accelerometer is used)                                                                                                                                                                                                                   | accelerometer is used)                                                                                                                                                                                                                   | accelerometer is used)                                                                                                                                                                                                                   | AB 00                                                                                                                             |
| START  1.4  AA 44 00** 01 00  By default, the algorithm sets the following AFE registers:  Sample rate: 100Hz, 1-sample averaging  Integration time: 117μs ADCs  1 and 2 range: 32μA | Enable AFE (e.g., MAX86141).**  Wait for 100ms before sending the next command. Any command to change the sensor registers should                                                                                                        | Enable AFE (e.g., MAX86141).**  Wait for 100ms before sending the next command. Any command to change the sensor registers should                                                                                                        | Enable AFE (e.g., MAX86141).**  Wait for 100ms before sending the next command. Any command to change the sensor registers should                                                                                                        | Enable AFE (e.g., MAX86141).**  Wait for 100ms before sending the next command. Any command to change the sensor registers should |
|                                                                                                                                                                                      | appear AFTER enabling the sensor or they will be overwritten.                                                                                                                                                                            | appear AFTER enabling the sensor or they will be overwritten.                                                                                                                                                                            | appear AFTER enabling the sensor or they will be overwritten.                                                                                                                                                                            | appear AFTER enabling the sensor or they will be overwritten.                                                                     |
|                                                                                                                                                                                      | 1.10                                                                                                                                                                                                                                     | AA 40 00 12 18                                                                                                                                                                                                                           | Set the sample rate of the MAX86141 to 100Hz with 1-                                                                                                                                                                                     | AB 00                                                                                                                             |
|                                                                                                                                                                                      | sample averaging.  1.11  AA 40 00 23 7F  Set the MAX86141 LED1 current to half of full scale.  Reduce [7F] if the signal is saturated.                                                                                                   | sample averaging.  1.11  AA 40 00 23 7F  Set the MAX86141 LED1 current to half of full scale.  Reduce [7F] if the signal is saturated.                                                                                                   | sample averaging.  1.11  AA 40 00 23 7F  Set the MAX86141 LED1 current to half of full scale.  Reduce [7F] if the signal is saturated.                                                                                                   | AB 00                                                                                                                             |
|                                                                                                                                                                                      | 1.12  AA 40 00 24 7F  Set the MAX86141 LED2 current to half of full scale.  Reduce [7F] if the signal is saturated.                                                                                                                      | 1.12  AA 40 00 24 7F  Set the MAX86141 LED2 current to half of full scale.  Reduce [7F] if the signal is saturated.                                                                                                                      | 1.12  AA 40 00 24 7F  Set the MAX86141 LED2 current to half of full scale.  Reduce [7F] if the signal is saturated.                                                                                                                      | AB 00                                                                                                                             |
|                                                                                                                                                                                      | 1.13                                                                                                                                                                                                                                     | AA 40 00 25 7F                                                                                                                                                                                                                           | Set the MAX86141 LED3 current to half of full scale.                                                                                                                                                                                     | AB 00                                                                                                                             |
|                                                                                                                                                                                      | Reduce [7F] if the signal is saturated.  Host reads samples periodically (repeated as needed):                                                                                                                                           | Reduce [7F] if the signal is saturated.  Host reads samples periodically (repeated as needed):                                                                                                                                           | Reduce [7F] if the signal is saturated.  Host reads samples periodically (repeated as needed):                                                                                                                                           | Reduce [7F] if the signal is saturated.  Host reads samples periodically (repeated as needed):                                    |
| READING SAMPLES                                                                                                                                                                      | 2.1  AA 00 00  Read the sensor hub status byte:  Bit 0: Sensor comm error  Bits 1 and 2: Reserved  Bit 3: FIFO filled to threshold (DataRdyInt)  Bit 4: Output FIFO overflow (FifoOutOvrInt)  Bit 5: Input FIFO overflow (FifoInOverInt) | 2.1  AA 00 00  Read the sensor hub status byte:  Bit 0: Sensor comm error  Bits 1 and 2: Reserved  Bit 3: FIFO filled to threshold (DataRdyInt)  Bit 4: Output FIFO overflow (FifoOutOvrInt)  Bit 5: Input FIFO overflow (FifoInOverInt) | 2.1  AA 00 00  Read the sensor hub status byte:  Bit 0: Sensor comm error  Bits 1 and 2: Reserved  Bit 3: FIFO filled to threshold (DataRdyInt)  Bit 4: Output FIFO overflow (FifoOutOvrInt)  Bit 5: Input FIFO overflow (FifoInOverInt) | AB 00 08                                                                                                                          |
| STOP                                                                                                                                                                                 | If DataRdyInt is set, proceed to the next step.  2.2  AA 12 00  Get the number of samples (nn) in the FIFO.                                                                                                                              | If DataRdyInt is set, proceed to the next step.  2.2  AA 12 00  Get the number of samples (nn) in the FIFO.                                                                                                                              | If DataRdyInt is set, proceed to the next step.  2.2  AA 12 00  Get the number of samples (nn) in the FIFO.                                                                                                                              | AB 00 nn                                                                                                                          |
|                                                                                                                                                                                      | 2.3  AA 12 01  Read the data stored in the FIFO; nn samples (24 bytes  each) will be included. The format of samples is shown in  Table 6   .                                                                                            | 2.3  AA 12 01  Read the data stored in the FIFO; nn samples (24 bytes  each) will be included. The format of samples is shown in  Table 6   .                                                                                            | 2.3  AA 12 01  Read the data stored in the FIFO; nn samples (24 bytes  each) will be included. The format of samples is shown in  Table 6   .                                                                                            | AB 00  data\_for\_                                                                                                                |
|                                                                                                                                                                                      | Host ends the procedure:                                                                                                                                                                                                                 | Host ends the procedure:                                                                                                                                                                                                                 | Host ends the procedure:                                                                                                                                                                                                                 |                                                                                                                                   |
|                                                                                                                                                                                      | 3.1                                                                                                                                                                                                                                      | AA 44 00** 00                                                                                                                                                                                                                            | Disable the AFE (e.g., the MAX86141).**                                                                                                                                                                                                  | AB 00                                                                                                                             |

Table 6. Format of Received Samples-Raw Data Mode

| DATA SOURCE              | BYTE  INDEX | DATA  ITEM | # OF BYTES  (MSB FIRST) | DESCRIPTION                    |
| ------------------------ | ----------- | ---------- | ----------------------- | ------------------------------ |
|                          | 0           | PPG1       | 3                       | Green counter                  |
|                          | 3           | PPG2       | 3                       | N/A                            |
| MAX86141  PPG Data       | 6           | PPG3       | 3                       | N/A                            |
| (18 Bytes)               | 9           | PPG4       | 3                       | Green2 counter                 |
|                          | 12          | PPG5       | 3                       | IR counter                     |
|                          | 15          | PPG6       | 3                       | Red counter                    |
| Accelerometer  (6 Bytes) | 18          | accelX     | 2                       | Two's complement. LSB = 0.001g |
| Accelerometer  (6 Bytes) | 20          | accelY     | 2                       | Two's complement. LSB = 0.001g |
| Accelerometer  (6 Bytes) | 22          | accelZ     | 2                       | Two's complement. LSB = 0.001g |

## 3.2 AGC Mode

In this mode, the wearable algorithm suite (SpO2  and WHRM) is enabled and the R value, SpO2 , SpO2 confidence level, heart rate, heart-rate confidence level, RR value, and activity class are reported. Furthermore, automatic gain control (AGC) is enabled. Because AGC is a subset of AEC functionality, to enable AGC, AEC still needs to be enabled. However, automatic calculation of target PD should be turned off, and the desired level of AGC target PD current is set by the user. The user may change the algorithm to the desired configuration mode, as shown in Table 11 . If signal quality is low, a LowSNR flag will be set. Excessive motion is also reported with a flag. The sequence of commands is shown in Table 7 .

Following operation mode of the algorithm can be selected as described in Table 11 :

- 0. Continuous  HRM  +  Continuous  SpO2: Both heart-rate and  SpO2  values  are continuously measured and updated.
- 1. Continuous  HRM  +  One-Shot  SpO2: Heart  rate  is  continuously  monitored;  SpO2   is measured once.
- 2. Continuous HRM: Only the heart-rate algorithm in continuous mode is enabled.
- 3. Sampled HRM: It measures heart rate once using the sampled HRM algorithm and then switches to activity mode.
- 4. Sampled HRM + One-Shot SpO2: It measures heart rate and SpO2 , and then switches to activity mode.
- 5. Activity Tracking ONLY: Only shows accelerometer data. LEDs are off.
- 6. SpO2 Calibration: Used for SpO2  calibration. Only red and IR LEDs are activated, and R value is being measured and updated to be used in the calibration procedure.

Table 7. Host Commands-AGC Mode

|                                                                          | #                                                                        | HOST COMMAND  (HEX)                                                                                                                                        | COMMAND DESCRIPTION                                                                                                                                                                                                                                         | RESPONSE  (HEX)                                                          |
| ------------------------------------------------------------------------ | ------------------------------------------------------------------------ | ---------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------ |
| Host initializes the MAX32664C in AGC mode using the following commands: | Host initializes the MAX32664C in AGC mode using the following commands: | Host initializes the MAX32664C in AGC mode using the following commands:                                                                                   | Host initializes the MAX32664C in AGC mode using the following commands:                                                                                                                                                                                    | Host initializes the MAX32664C in AGC mode using the following commands: |
| 1.1                                                                      | AA 50 07 00                                                              | [FFE69196000CB735 00989680]*                                                                                                                               | This step is ONLY needed if non-default calibration  coefficients are used to write the SpO2  calibration  coefficients as derived according to  section 2 . Provided                                                                                       | AB 00                                                                    |
|                                                                          | 1.2                                                                      | AA 10 00 03**                                                                                                                                              | coefficients are for example only.*  Set the output mode to sensor + algorithm data (streamed  data will include PPG, accelerometer, and algorithm data).**                                                                                                 | AB 00                                                                    |
|                                                                          | 1.3                                                                      | AA 10 01 01                                                                                                                                                | Set the sensor hub interrupt threshold.                                                                                                                                                                                                                     | AB 00                                                                    |
|                                                                          | 1.4                                                                      | AA 10 02 01**                                                                                                                                              | Set the report rate to be one report per every sensor  sample.**                                                                                                                                                                                            | AB 00                                                                    |
| 1.5                                                                      |                                                                          | AA 44 04 01 01 (if  host accelerometer is                                                                                                                  | Enable the host-side accelerometer, if used.                                                                                                                                                                                                                | AB 00                                                                    |
| START                                                                    | 1.6                                                                      | used)  AA 50 07 0A 00                                                                                                                                      | Set the algorithm operation mode to Continuous HRM and  Continuous SpO2  or as needed. See  Table 11 .                                                                                                                                                      | AB 00                                                                    |
|                                                                          | 1.7                                                                      | AA 50 07 0B 01                                                                                                                                             | Enable AEC [enabled by default].                                                                                                                                                                                                                            | AB 00                                                                    |
| 1.8                                                                      |                                                                          | AA 50 07 12 00                                                                                                                                             | Disable Auto PD Current Calculation.****                                                                                                                                                                                                                    | AB 00                                                                    |
| 1.9                                                                      |                                                                          | AA 50 07 0C 00                                                                                                                                             | Disable SCD.                                                                                                                                                                                                                                                | AB 00                                                                    |
|                                                                          | 1.10                                                                     | AA 50 07 11 00 64                                                                                                                                          | Set AGC Target PD Current to 10 μ A or as needed.                                                                                                                                                                                                           | AB 00                                                                    |
| 1.11                                                                     |                                                                          | Optional: Any command to change the algorithm settings and configurations ( Table 11 ) from the  default should appear here BEFORE enabling the algorithm. |                                                                                                                                                                                                                                                             |                                                                          |
| 1.12                                                                     |                                                                          | AA 52 07 01 (normal  algorithm report)  AA 52 07 02                                                                                                        | Enable WHRM and SpO2  algorithm.  The format of samples is shown in  Table 8  (normal  algorithm report) or  Table 9  (extended algorithm report).                                                                                                          | AB 00                                                                    |
| report)  Host reads samples periodically (repeated as needed):           | report)  Host reads samples periodically (repeated as needed):           | report)  Host reads samples periodically (repeated as needed):                                                                                             | report)  Host reads samples periodically (repeated as needed):                                                                                                                                                                                              | report)  Host reads samples periodically (repeated as needed):           |
| 2.1                                                                      | AA 00 00                                                                 | Bit 7: Reserved                                                                                                                                            | Read the sensor hub status byte:  Bit 0: Sensor comm error  Bits 1 and 2: Reserved  Bit 3: FIFO filled to threshold (DataRdyInt)  Bit 4: Output FIFO overflow (FifoOutOvrInt)  Bit 5: Input FIFO overflow (FifoInOverInt)  Bit 6: Sensor hub busy (DevBusy) | AB 00 08                                                                 |
| READING SAMPLES                                                          | 2.2                                                                      | AA 12 00                                                                                                                                                   | If DataRdyInt is set, proceed to the next step.  Get the number of samples (nn) in the FIFO.                                                                                                                                                                | AB 00 nn                                                                 |
|                                                                          | 2.3                                                                      | AA 12 01                                                                                                                                                   | Table 8  (normal  Table 9  (extended algorithm report).                                                                                                                                                                                                     | AB 00  data\_for\_                                                       |
| STOP                                                                     |                                                                          |                                                                                                                                                            | Read the data stored in the FIFO; nn samples will be read.  The format of the samples is shown in  algorithm report) or                                                                                                                                     | nn\_samples                                                              |
|                                                                          | Host ends the procedure:                                                 | Host ends the procedure:                                                                                                                                   | Host ends the procedure:                                                                                                                                                                                                                                    | Host ends the procedure:                                                 |
|                                                                          | 3.1                                                                      | AA 52 07 00                                                                                                                                                | Disable the algorithm.                                                                                                                                                                                                                                      | AB 00                                                                    |

Table 8. Format of Received Samples-Normal Algorithm Report

| DATA  SOURCE                  | BYTE  INDEX | DATA ITEM                                      | # OF BYTES  (MSB FIRST) | DESCRIPTION                                                                                                                                                                                    |
| ----------------------------- | ----------- | ---------------------------------------------- | ----------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
|                               |             | PPG1                                           | 3                       | Green counter                                                                                                                                                                                  |
| MAX86141  PPG Data            | 0  3        | PPG2                                           | 3                       | N/A                                                                                                                                                                                            |
| MAX86141  PPG Data            | 6           | PPG3                                           | 3                       | N/A                                                                                                                                                                                            |
| MAX86141  PPG Data            |             | PPG4                                           | 3                       | Green2 counter                                                                                                                                                                                 |
| (18 Bytes)*                   | 9  12       | PPG5                                           | 3                       | IR LED counter                                                                                                                                                                                 |
| MAX86141  PPG Data            | 15          | PPG6                                           | 3                       | Red LED counter                                                                                                                                                                                |
|                               | 18          | accelX                                         | 2                       | Two's complement. LSB = 0.001g                                                                                                                                                                 |
| (6 Bytes)*                    | 20          | accelY                                         | 2                       | Two's complement. LSB = 0.001g                                                                                                                                                                 |
| Accelerometer                 |             | accelZ                                         | 2                       |                                                                                                                                                                                                |
|                               | 22          |                                                |                         | Two's complement. LSB = 0.001g  Current operation mode:                                                                                                                                        |
| Algorithm                     | 24          | Op mode                                        | 1                       | 0: Continuous HRM and Continuous SpO2   1: Continuous HRM and One-Shot SpO2   2: Continuous HRM  3: Sampled HRM  4: Sampled HRM and One-Shot SpO2   5: Activity tracking  6: SpO2  calibration |
|                               | 25          | HR                                             | 2                       | 10x last calculated heart rate                                                                                                                                                                 |
|                               | 27          | HR confidence                                  | 1                       | Last calculated confidence level in %                                                                                                                                                          |
|                               | 28          | RR                                             | 2                       | 10x RR - interbeat interval in ms  Only shows a nonzero value when a new  value is calculated.                                                                                                 |
|                               | 30          | RR confidence                                  |                         | Calculated confidence level of RR in %  Only shows a nonzero value when a new                                                                                                                  |
| Wearable  Suite  (20 Bytes)** | 31          | Activity class                                 | 1  1                    | value is calculated.  Activity class:  0: Rest  1: Other  2: Walk  3: Run  4: Bike                                                                                                             |
|                               | 32  34      | R                                              | 2                       | 1000x last calculated SpO2  R value  Last calculated SpO2  confidence level                                                                                                                    |
|                               |             |                                                | 1                       | in %                                                                                                                                                                                           |
|                               |             | SpO2 confidence                                |                         |                                                                                                                                                                                                |
|                               | 35          | SpO2                                           | 2                       | 10x last calculated SpO2  %  Calculation progress in % in one-shot                                                                                                                             |
|                               | 37          | SpO2 % complete  SpO2 low signal  quality flag | 1                       | is reported as zero and only jumps to 100  when the SpO2 value is updated.  Shows the low quality of the PPG signal:  0: Good quality                                                          |
|                               | 38          |                                                | 1                       | 1: Low quality                                                                                                                                                                                 |
|                               | 39          | SpO2 motion flag                               | 1                       |                                                                                                                                                                                                |
|                               |             |                                                |                         | Shows excessive motion:  0: No motion  1: Excessive motion                                                                                                                                     |
|                               | 40          | SpO2 low PI flag                               | 1                       | Shows the low perfusion index (PI) of the  PPG signal:  0: Normal PI  1: Low PI  Shows the reliability of R:                                                                                   |
|                               | 41  42      | SpO2 unreliable R  flag  SpO2 state            | 1  1                    | 0: Reliable  1: Unreliable  Reported status of the SpO2  algorithm:  0: LED adjustment                                                                                                         |

Table 9. Format of Received Samples-Extended Algorithm Report

|     |           |     | 1: Computation  2: Success  3: Timeout                                          |
| --- | --------- | --- | ------------------------------------------------------------------------------- |
| 43  | SCD state | 1   | Skin contact state:  0: Undetected  1: Off skin  2: On some subject  3: On skin |

- *If the output mode includes the sensor.
- **If the output mode includes the algorithm.

| DATA  SOURCE                             | BYTE  INDEX | DATA ITEM                 | # OF BYTES  (MSB FIRST) | DESCRIPTION                                                                                                                                                                                                                                             |
| ---------------------------------------- | ----------- | ------------------------- | ----------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
|                                          | 0           | PPG1                      | 3                       | Green counter                                                                                                                                                                                                                                           |
| MAX86141  PPG Data                       | 3           | PPG2                      | 3                       |                                                                                                                                                                                                                                                         |
| MAX86141  PPG Data                       | 6           | PPG3                      | 3                       | N/A  N/A                                                                                                                                                                                                                                                |
| (18 Bytes)*                              | 9           | PPG4                      | 3                       | Green2 counter                                                                                                                                                                                                                                          |
| MAX86141  PPG Data                       | 12          | PPG5                      | 3                       | IR LED counter                                                                                                                                                                                                                                          |
| MAX86141  PPG Data                       | 15          | PPG6                      | 3                       | Red LED counter                                                                                                                                                                                                                                         |
| Accelerometer                            | 18          | accelX                    | 2                       | Two's complement. LSB = 0.001g                                                                                                                                                                                                                          |
| Accelerometer                            | 20          | accelY                    | 2                       | Two's complement. LSB = 0.001g                                                                                                                                                                                                                          |
| (6 Bytes)*                               | 22          | accelZ                    | 2                       | Two's complement. LSB = 0.001g                                                                                                                                                                                                                          |
|                                          |             | Op mode                   |                         | Current operation mode:  0: Continuous HRM and Continuous SpO2   1: Continuous HRM and One-Shot SpO2   2: Continuous HRM  3: Sampled HRM  4: Sampled HRM and One-Shot SpO2   5: Activity Tracking  6: SpO2  Calibration  10x last calculated heart rate |
| Wearable  Suite  Algorithm  (52 Bytes)** | 24          |                           | 1                       |                                                                                                                                                                                                                                                         |
| Wearable  Suite  Algorithm  (52 Bytes)** | 25          | HR                        | 2                       |                                                                                                                                                                                                                                                         |
| Wearable  Suite  Algorithm  (52 Bytes)** | 27          | HR confidence             | 1                       | Last calculated confidence level in %                                                                                                                                                                                                                   |
| Wearable  Suite  Algorithm  (52 Bytes)** | 28          | RR                        | 2                       | 10x RR - inter-beat interval in ms  Only shows a nonzero value when a new  value is calculated.  Calculated confidence level of RR in %                                                                                                                 |
| Wearable  Suite  Algorithm  (52 Bytes)** | 30          | RR confidence             | 1                       | Only shows a nonzero value when a new  value is calculated.  Activity class:  0: Rest  1: Other  2: Walk  3: Run  4: Bike                                                                                                                               |
| Wearable  Suite  Algorithm  (52 Bytes)** | 31          | Activity class            | 1                       |                                                                                                                                                                                                                                                         |
| Wearable  Suite  Algorithm  (52 Bytes)** | 32          | Total walk  steps         | 4                       | Total number of walking steps since the last  reset                                                                                                                                                                                                     |
| Wearable  Suite  Algorithm  (52 Bytes)** | 36          | Total run steps           | 4                       | Total number of running steps since the last  reset                                                                                                                                                                                                     |
| Wearable  Suite  Algorithm  (52 Bytes)** | 40          | Total energy  exp in kcal | 4                       | 10x total energy expenditure since the last  reset in kcal                                                                                                                                                                                              |
| Wearable  Suite  Algorithm  (52 Bytes)** | 44          | Total AMR in              | 4                       | 10x total active energy expenditure since the                                                                                                                                                                                                           |

|        | requested in  first time slot                               |      |                                                                                                                                                                 |
| ------ | ----------------------------------------------------------- | ---- | --------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 49     | Adjusted LED  current in first  time slot                   | 2    | 10x value of the adjusted LED current (mA) in  the first time slot, valid only if 'Is LED current  adjustment requested in first time slot' flag is  true       |
| 51     | Is LED current  adjustment  requested in  second time  slot | 1    | Flag to notify if the LED current adjustment is  requested or not in the second time slot                                                                       |
| 52     | Adjusted LED  current in  second time  slot                 | 2    | 10x value of the adjusted LED current (mA) in  the second time slot, valid only if the 'Is LED  current adjustment requested in second time  slot' flag is true |
| 54     | Is LED current  adjustment  requested in  third time slot   | 1    | Flag to notify if the LED current adjustment is  requested or not in the third time slot                                                                        |
| 55     | Adjusted LED  current in third  time slot                   | 2    | 10x value of the adjusted LED current (mA) in  third time slot, valid only if the 'Is LED current  adjustment requested in third time slot' flag is  true       |
| 57     | Is integration  time  adjustment  requested                 | 1    | Flag to notify if the integration time  adjustment is requested or not                                                                                          |
| 58     | Requested  integration time                                 | 1    | Value of the requested integration time  option, valid only if the 'Is integration time  adjustment requested' flag is true                                     |
| 59     | Is sampling  rate adjustment  requested                     | 1    | Flag to notify if the sampling rate adjustment  is requested or not                                                                                             |
| 60     | Requested  sampling rate                                    | 1    | Value of the requested sampling rate option,  valid only if the 'Is sampling rate adjustment  requested' flag is true                                           |
| 61     | Requested  sampling  average  WHRM AFE                      | 1    | Sampling average required for the requested  sampling rate, valid only if the 'Is sampling  rate adjustment requested' flag is true                             |
| 62     | controller state  for HRM  channels                         | 1    | State of the AFE manager (for WHRM  channels)                                                                                                                   |
| 63     | Is high motion  for HRM                                     | 1    | Flag to notify if the motion is considered high  for heart-rate measurement  Skin contact state:                                                                |
| 64     | SCD state                                                   | 1    | 0: Undetected  1: Off skin  2: On some subject  3: On skin                                                                                                      |
| 65     | R                                                           | 2    | 1000x last calculated SpO2  R value                                                                                                                             |
| 67     | SpO2  confidence                                            | 1    | Last calculated confidence level in %                                                                                                                           |
| 68  70 | SpO2  SpO2 %                                                | 2  1 | 10x last calculated SpO2  %  Calculation progress in % in one-shot mode  of algorithm. In continuous mode, it is                                                |

| 71  | SpO2 low  signal quality  flag | 1   | Shows the low quality of the PPG signal:  0: Good quality  1: Low quality                          |
| --- | ------------------------------ | --- | -------------------------------------------------------------------------------------------------- |
| 72  | SpO2 motion  flag              | 1   | Shows excessive motion:  0: No motion  1: Excessive motion                                         |
| 73  | SpO2 low PI  flag              | 1   | Shows the low perfusion index (PI) of the  PPG signal:  0: Normal PI  1: Low PI                    |
| 74  | SpO2  unreliable R  flag       | 1   | Shows the reliability of R:  0: Reliable  1: Unreliable                                            |
| 75  | Status                         | 1   | Reported status of the SpO2  algorithm:  0: LED adjustment  1: Computation  2: Success  3: Timeout |

- *If the output mode includes the sensors.

## 3.3 AEC Mode

In this mode, the algorithm and AEC and SCD are all enabled (by default). The algorithm mode of operation can be selected as described in previous section. The sequence of commands is shown in Table 10 .

Table 10. Host Commands-AEC Mode

|                                                                              | #                                                                            | HOST COMMAND  (HEX)                                                                                 | COMMAND DESCRIPTION                                                                                                                                                                                                                                                                                                   | RESPONSE  (HEX)                                                                                     |
| ---------------------------------------------------------------------------- | ---------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------- |
| Host initializes the MAX32664C in AEC-SCD mode using the following commands: | Host initializes the MAX32664C in AEC-SCD mode using the following commands: | Host initializes the MAX32664C in AEC-SCD mode using the following commands:                        | Host initializes the MAX32664C in AEC-SCD mode using the following commands:                                                                                                                                                                                                                                          | Host initializes the MAX32664C in AEC-SCD mode using the following commands:                        |
|                                                                              | 1.1                                                                          | AA 50 07 00  [FFE69196000CB73500 989680]*                                                           | This step is ONLY needed if non-default calibration  coefficients are used to write the SpO2  calibration  coefficients as derived according to  section 2 . Provided  coefficients are for example only.*                                                                                                            | AB 00                                                                                               |
|                                                                              | 1.2                                                                          | AA 10 00 03**                                                                                       | Set the output mode to sensor + algorithm data  (streamed data will include PPG, accelerometer, and  algorithm data).**                                                                                                                                                                                               | AB 00                                                                                               |
|                                                                              | 1.3                                                                          | AA 10 01 01                                                                                         | Set the sensor hub interrupt threshold.                                                                                                                                                                                                                                                                               | AB 00                                                                                               |
|                                                                              | 1.4                                                                          | AA 10 02 01**                                                                                       | Set the report rate to be one report per every sensor  sample.**                                                                                                                                                                                                                                                      | AB 00                                                                                               |
|                                                                              | 1.5                                                                          | AA 44 04 01 01 (if host  accelerometer is used)                                                     | Enable the host-side accelerometer, if used.                                                                                                                                                                                                                                                                          | AB 00                                                                                               |
|                                                                              | 1.6                                                                          | AA 50 07 0A 00                                                                                      | Set the algorithm operation mode to Continuous HRM  and Continuous SpO2  or as desired. See  Table 11 .                                                                                                                                                                                                               | AB 00                                                                                               |
|                                                                              | 1.7                                                                          | AA 50 07 0B 01                                                                                      | Enable AEC [enabled by default].                                                                                                                                                                                                                                                                                      | AB 00                                                                                               |
|                                                                              | 1.8                                                                          | AA 50 07 12 01                                                                                      | Enable Auto PD Current Calculation [enabled by default].                                                                                                                                                                                                                                                              | AB 00                                                                                               |
|                                                                              | 1.9                                                                          | AA 50 07 0C 01                                                                                      | Enable SCD [enabled by default].                                                                                                                                                                                                                                                                                      | AB 00                                                                                               |
| should appear here BEFORE enabling the algorithm.                            | 1.10                                                                         | Optional: Any command to change the algorithm settings and configurations ( Table 11 ) from default | Optional: Any command to change the algorithm settings and configurations ( Table 11 ) from default                                                                                                                                                                                                                   | Optional: Any command to change the algorithm settings and configurations ( Table 11 ) from default |
|                                                                              | 1.11                                                                         | AA 52 07 01 (for normal  algorithm report)  AA 52 07 02 (for  extended algorithm  report)           | Enable the WHRM and SpO2  algorithm.  The format of the samples is shown in  Table 8  (normal  algorithm report) or  Table 9  (extended algorithm report).                                                                                                                                                            | AB 00                                                                                               |
|                                                                              |                                                                              | Host reads samples periodically (repeated as needed):                                               | Host reads samples periodically (repeated as needed):                                                                                                                                                                                                                                                                 | Host reads samples periodically (repeated as needed):                                               |
|                                                                              | 2.1                                                                          | AA 00 00                                                                                            | Read sensor hub status byte:  Bit 0: Sensor comm error  Bits 1 and 2: Reserved  Bit 3: FIFO filled to threshold (DataRdyInt)  Bit 4: Output FIFO overflow (FifoOutOvrInt)  Bit 5: Input FIFO overflow (FifoInOverInt)  Bit 6: Sensor hub busy (DevBusy)  Bit 7: Reserved  If DataRdyInt is set, proceed to next step. | AB 00 08                                                                                            |
|                                                                              | 2.2                                                                          | AA 12 00                                                                                            | Get the number of samples (nn) in the FIFO.                                                                                                                                                                                                                                                                           | AB 00 nn                                                                                            |
|                                                                              | 2.3                                                                          | AA 12 01                                                                                            | Read the data stored in the FIFO; nn samples will be  read. The format of the samples is shown in  Table 8 (normal algorithm report) or  Table 9  (extended algorithm  report).                                                                                                                                       | AB 00  data\_for\_  nn\_samples                                                                     |

## 3.4 Power-Saving Mode

This mode is similar to the previously described mode where the algorithm, AEC and SCD are enabled (by default). The only differences are to change the following in Table 10 :

- · Change the output mode in step 1.2 to Algorithm Only (0x02) as shown in Table 12 .
- · Change the report rate in step 1.4 to 25 (0x19) or more as shown in Table 12 .
- · Adjust the host polling period according to the report rate.
- · Choose the desired algorithm operation mode in step 1.7. The Sampled HRM mode saves more power as it automatically switches to Activity Tracking mode once the heart rate is measured. In this case, the host may choose to reconfigure the operation mode as needed (e.g., in case of motion).
- · Enable the WHRM and SpO2 algorithm in step 1.11 in normal report mode.

This configuration helps the MAX32664C to wake up less often, and I2C communication time is minimized. The report detailed in Table 8 will only include algorithm data.

Note:  This  mode  is  not  appropriate  for  monitoring  interbeat  interval  (RR)  value.  RR  and  RR Confidence are reported whenever a new value is calculated by the algorithm and shown as zero for the rest of the time. Therefore, the last reported value may be missed if the report rate is not set to 1.

## 4 Configurations and Settings

The settings shown in Table 11 are available for the wearable suite (SpO2  and WHRM) algorithm. To  update  the  algorithm  settings,  make  sure  to  send  the  appropriate  commands  BEFORE enabling the algorithm.

Table 12 lists a number of frequently used sensor hub settings and commands. For the full list, refer to the MAX32664 User Guide .

Table 11. Algorithm Configuration and Settings

| FAMILY  BYTE    | ALGORITHM  INDEX | CONFIGURATION  INDEX | DESCRIPTION                                                                                                                                                                  | DEFAULT  VALUE  (MSB  FIRST)   |
| --------------- | ---------------- | -------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------ |
| write  0x51 for |                  | 0x00                 | SpO2 calibration coefficients x 100,000  (12 bytes comprised of three 32-bit  signed values)                                                                                 | 0xFFE69196  000CB735  00989680 |
| write  0x51 for |                  | 0x01                 | SpO2 motion-detection period  (unsigned 16-bit int) [sec]                                                                                                                    | 0x0002                         |
| write  0x51 for | 0x07             | 0x02                 | SpO2 motion-detection threshold  (signed 32-bit int, equal to 10  x actual  5 float threshold value; value1: MSB in 4  bytes signed int, value4: LSB in 4 bytes  signed int) | 0x01C9C380                     |
| write  0x51 for |                  | 0x03                 | SpO2 AGC Timeout [sec]                                                                                                                                                       | 0x3C                           |
| write  0x51 for |                  | 0x04                 | SpO2 Algorithm Timeout [sec]                                                                                                                                                 | 0x5A                           |
| write  0x51 for |                  | 0x05                 | Initial HR value                                                                                                                                                             | 0x3C                           |
| write  0x51 for |                  | 0x06                 | Height [cm] (Height = 256 x  &lt;value\_MSB&gt; + &lt;value\_LSB&gt; cm)                                                                                                     | 0x00AF                         |

| 0x07 | Weight [kg] (Weight = 256 x  &lt;value\_MSB&gt; + &lt;value\_LSB&gt; kg)                                                                               | 0x004E |
| ---- | ------------------------------------------------------------------------------------------------------------------------------------------------------ | ------ |
| 0x08 | Age [years] (Age = &lt;value&gt; years)                                                                                                                | 0x1E   |
| 0x09 | Gender  0x00: Male  0x01: Female  Algorithm operation mode (can be                                                                                     | 0x00   |
| 0x0A | switched in runtime):  0x00: Continuous HRM + Continuous  SpO2.    0x01: Continuous HRM + One-Shot  SpO2  0x02: Continuous HRM  0x03: Sampled HRM      | 0x00   |
| 0x0B | AEC enable  0x00: Disable  0x01: Enable                                                                                                                | 0x01   |
| 0x0C | SCD enable  0x00: Disable  0x01: Enable                                                                                                                | 0x01   |
| 0x0D | Adjusted target PD current period in  seconds. (16-bit unsigned)                                                                                       | 0x0708 |
| 0x0E | Motion magnitude threshold in 0.001g.  (16-bit unsigned)                                                                                               | 0x0032 |
| 0x0F | Minimum PD current in 0.1mA. (16-bit  unsigned)                                                                                                        | 0x0032 |
| 0x10 | Initial PD current in 0.1mA. (16-bit  unsigned)                                                                                                        | 0x0064 |
| 0x11 | Target PD current in 0.1mA. (16-bit  unsigned) Works only if Auto Target PD  Current Calculation is enabled.                                           | 0x0064 |
| 0x12 | Automatic calculation of target PD  current:  0x00: Disable  0x01: Enable                                                                              | 0x01   |
| 0x13 | Minimum integration time:  0x00: 14.8 μs 0x01: 29.4 μs 0x02: 58.7 μs 0x03: 117.3 μs                                                                    | 0x00   |
| 0x14 | Minimum sampling rate and averaging:  0x00: 25sps, avg = 1  0x01: 50sps, avg = 2  0x02: 100sps, avg = 4  0x03: 200sps, avg = 8  0x03: 400sps, avg = 16 | 0x00   |
| 0x15 | Maximum integration time:  0: 14.8 μs 1: 29.4 μs 2: 58.7 μs 3: 117.3 μs                                                                                | 0x03   |
| 0x16 | Maximum sampling rate and averaging:  0: 25sps, avg = 1  1: 50sps, avg = 2  2: 100sps, avg = 4                                                         | 0x02   |

|      | 3: 200sps, avg = 8  4: 400sps, avg = 16                                                                                                                                                                                                                                                         |        |
| ---- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------ |
| 0x1A | Initial integration time:  0: 14.8 μs 1: 29.4 μs 2: 58.7 μs 3: 117.3 μs                                                                                                                                                                                                                         | 0x03   |
| 0x1B | Initial sampling rate and averaging:  0: 25sps, avg = 1  1: 50sps, avg = 2  2: 100sps, avg = 4  3: 200sps, avg = 8                                                                                                                                                                              | 0x02   |
| 0x17 | 4: 400sps, avg = 16  LED PD configuration for 2 channels of  WHRM (MS byte channel 1, and LS  byte channel 2):  For each channel, 4-bit MSB is LED #  and 4-bit LSB is PD #:  - LED #: 0-2 for LED1-LED3; 7: LED  not used  - PD #: 0-1 for PD1-PD2; 3: PD not  used  For one channel case, use | 0x0001 |
| 0x18 | LED PD configuration for SpO2  (MS  byte: IR channel; LS byte: red channel):  For each red or IR channel, 4-bit MSB  is LED # and 4-bit LSB is PD #:  - LED #: 0-2 for LED1-LED3; 7: LED  not used  - PD #: 0-1 for PD1-PD2; 3: PD not  used                                                    | 0x1020 |

Table 12. Frequently Used Sensor Hub Settings and Commands

| COMMAND  FAMILY BYTE          | COMMAND  INDEX | VALUE                               | DESCRIPTION                                                                                                                                                                                                                                                                                                  |
| ----------------------------- | -------------- | ----------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| 0x01 for write                | 0x00           | 0x01                                | Shut down the MAX32664C. Restart is only possible by  power cycle or toggling RSTN.                                                                                                                                                                                                                          |
| 0x10 for write  0x11 for read | 0x00           | One byte  in the 1- 3 range         | Output mode:  1: Sensor only  2: Algorithm only  3: Algorithm and sensor data                                                                                                                                                                                                                                |
| 0x10 for write  0x11 for read | 0x02           | One byte                            | Configures the report period per number of samples.  For example, if the value is 1 (default), the report is  generated every sample (40ms). If the value is 25, the  report is generated once every 25 samples (1s).                                                                                        |
| 0x10 for write                | 0x03           | New  one-byte  I2C  address         | Change the default I2C address from 0xAA. The new  address will be effective only AFTER sending the  response of this command to the host.                                                                                                                                                                   |
| 0x46 for write                | 0x04           | 0x00  followed  by a 3- byte  value | 1: Enabled  - Middle byte: WUFC*: the time in seconds in which  motion should be present before a wake up interrupt.  WUFC = desired time (s) x 25  Example: For a 0.2s time, set WUFC to 5.  - LS byte: ATH*: the motion level threshold  ATH = Desired threshold (g) x 16  Example: For 0.5g, set ATH to 8 |

*As defined in the KX122 data sheet.

## 5 Using SCD State and Motion Detection for Power Saving

In order to further reduce power consumption when the device is not placed on the skin, a motiondetection-enabled state machine can be implemented in the host. In this case, the MAX32664C stays in sleep mode until a motion event is reported by the accelerometer, or an I2C command is received from the host. Figure 4 demonstrates an example of such a state machine.

- Active State: Normally, the MAX32664C runs in Active state in AEC mode ( section 3.3 ) or Power Saving mode ( section 3.4 ).  If  the  SCD state in the report shows off-skin for certain time, the state machine switches to Probing state.
- Probing State: In this state, the host periodically turns the algorithm on and off. If an OnSkin state is reported while the algorithm is running, it will switch back to Active state and continue running the algorithm. Otherwise, after several attempts of turning the algorithm on and off (the off period can be increased after each attempt), it will switch to Off-Skin state. In Active and Probing states, the procedure to start, read report, or stop are similar to the regular sequence described in Table 10 for AEC mode , or as highlighted for PowerSaving mode.
- Off-Skin  State : In  Off-Skin  state,  the  goal  is  to  save  more  power  by  allowing  the MAX32664C to stay in sleep mode, so long as there is no motion. Depending on the use of a host or sensor hub accelerometer ( section 1.3 ), the host is required to configure the MAX32664C differently, as shown in Figure 4.

If  the  KX122  is  connected  to  the  MAX32664C  as  the  sensor  hub  accelerometer,  the MAX32664C must be configured to wake up on motion. In this case, the accelerometer is enabled in the  interrupt  mode  and  the  motion  threshold  and  the  duration  of  motion  is configured using the wake up on motion configuration command, as shown in Table 13 . Note  that  the  interrupt  line  of  the  accelerometer  is  required  to  be  connected  to  the MAX32664C as shown in Figure 1 ,  to  support  this  feature.  Once  the  MAX32664C  is configured, the host should start only the accelerometer. As soon as a motion interrupt occurs, the MAX32664C will wake up and read accelerometer samples and store them in the sensor hub FIFO. The host should periodically read the MAX32664C FIFO to check if any accelerometer sample has been captured since the last polling period. If there is a sample, the host should switch to Active state by first disabling the wake up on motion configuration and then restarting the algorithm.

In case of using a host-side accelerometer, the implementation exclusively relies on the host. In this case, the host accelerometer should be configured to interrupt on a certain level of motion for certain duration. Refer to the data sheet of the desired accelerometer for such a setting. The host can stop the MAX32664C when going to this mode and restart it as motion is detected using the same procedure shown in Table 10.

Figure 4. Example of an SCD-enabled, power-saving state machine.

<!-- image -->

Table 13. Host Commands to Enable/Disable Wake Up on Motion Configuration of Sensor Hub Accelerometer for Off-Skin State

| #                                                                                                                      |                                                                                                                                    | HOST COMMAND  (HEX)                                                                                                                | COMMAND DESCRIPTION                                                                                                                                                                                                              | RESPONSE  (HEX)                                                                                                                    |
| ---------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------- |
| Host initializes the MAX79356C to wake up on KX122 accelerometer motion detection in order to go  into off-skin state. | -                                                                                                                                  | -                                                                                                                                  | -                                                                                                                                                                                                                                | -                                                                                                                                  |
| 1.1                                                                                                                    | Stop the sensor, accelerometer, and algorithm if already enabled, as seen in step 3 in  Table  10 .                                | Stop the sensor, accelerometer, and algorithm if already enabled, as seen in step 3 in  Table  10 .                                | Stop the sensor, accelerometer, and algorithm if already enabled, as seen in step 3 in  Table  10 .                                                                                                                              | Stop the sensor, accelerometer, and algorithm if already enabled, as seen in step 3 in  Table  10 .                                |
| 1.2                                                                                                                    | AA 46 04 00 01 [05] 1  [08]                                                                                                        | 2 1 2                                                                                                                              | Set the sensor hub accelerator in wake up on  motion mode if motion is greater than a threshold  for a certain duration, for example:  [05]: 0.2s motion duration, see  Table 12 .  [08]: 0.5g motion threshold, see  Table 12 . | AB 00                                                                                                                              |
| 1.3                                                                                                                    |                                                                                                                                    | AA 10 00 01                                                                                                                        | Set the output mode to accelerometer only.                                                                                                                                                                                       | AB 00                                                                                                                              |
| 1.4                                                                                                                    |                                                                                                                                    | AA 10 02 01                                                                                                                        | Set the report rate to be one report per every  sensor sample.                                                                                                                                                                   | AB 00                                                                                                                              |
| 1.5                                                                                                                    |                                                                                                                                    | AA 44 04 01 00                                                                                                                     | Enable the sensor-hub accelerometer.  It will generate a report only if there is motion,  according to step 1.4.                                                                                                                 | AB 00                                                                                                                              |
| Host reads samples periodically (repeated as needed) during off-skin state:                                            |                                                                                                                                    |                                                                                                                                    |                                                                                                                                                                                                                                  |                                                                                                                                    |
| 2.1                                                                                                                    | Read samples as described in steps 2 in  Table 10.  Samples will only include accelerometer  data (6 bytes) as shown in  Table 9 . | Read samples as described in steps 2 in  Table 10.  Samples will only include accelerometer  data (6 bytes) as shown in  Table 9 . | Read samples as described in steps 2 in  Table 10.  Samples will only include accelerometer  data (6 bytes) as shown in  Table 9 .                                                                                               | Read samples as described in steps 2 in  Table 10.  Samples will only include accelerometer  data (6 bytes) as shown in  Table 9 . |
| SKIN                                                                                                                   | Host ends the wake up on motion configuration.                                                                                     | Host ends the wake up on motion configuration.                                                                                     | Host ends the wake up on motion configuration.                                                                                                                                                                                   | Host ends the wake up on motion configuration.                                                                                     |
|                                                                                                                        | 3.1                                                                                                                                | AA 44 04 00                                                                                                                        | Disable the accelerometer.                                                                                                                                                                                                       | AB 00                                                                                                                              |
| 3.2                                                                                                                    |                                                                                                                                    | AA 46 04 00 00 FF FF                                                                                                               | Disable wake up on motion. See  Table 12.                                                                                                                                                                                        | AB 00                                                                                                                              |
| 3.3                                                                                                                    | Proceed to start algorithm in AEC or Power Saving mode as in  Table 10.                                                            | Proceed to start algorithm in AEC or Power Saving mode as in  Table 10.                                                            | Proceed to start algorithm in AEC or Power Saving mode as in  Table 10.                                                                                                                                                          | Proceed to start algorithm in AEC or Power Saving mode as in  Table 10.                                                            |

## 6 Power Consumption Estimate

The MAX32664 sensor hub family runs in two distinct operating modes. The Active mode is the mode in which the execution of the firmware occurs. The Deep Sleep mode is enabled by the sensor hub to save power when the processor is idle or there is no need for any processing. It makes all internal clocks of the MAX32664 gated off. In this mode, only RTC is enabled as a source of backup for wakeup. As soon as a sensor interrupt is received, the MAX32664 wakes up,  completes  the  processing,  and  goes  back  to  sleep.  It  also  must  wake  up  prior  to  I2C communication by pulling MFIO low, as described in section 1.1 .

Table  8 and Table  15 show  the  power  consumption  in  each  mode.  To  estimate  the  power consumption while running the algorithm, the percentage of time that the MAX32664 is in Active mode is measured. For this measurement, the report interval is set to 1 second and only algorithm data is reported, as described in section 3.4 . The estimated power consumption for a selected number of algorithm operation modes is summarized in Table 16 .

## Table 14. Comparison of Active and Deep Sleep Power-Single Supply (VDD Only)

Table 16. Estimated Power Consumption for the MAX32664C

| MAX32664 OPERATIONAL MODE | POWER CONSUMPTION |
| ------------------------- | ----------------- |
| Active                    | 15.5664mW         |
| Deep Sleep                | 0.00756mW         |

## Table 15. Comparison of Active and Deep Sleep Power-Dual Supply (VDD and VCORE)

| MAX32664 OPERATIONAL MODE | POWER CONSUMPTION |
| ------------------------- | ----------------- |
| Active                    | 9.64106mW         |
| Deep Sleep                | 0.01383mW         |

| WEARABLE SUITE                          | MEASURED CPU  ACTIVE TIME | CALCULATED POWER CONSUMPTION  (AVERAGE)* | CALCULATED POWER CONSUMPTION  (AVERAGE)* |
| --------------------------------------- | ------------------------- | ---------------------------------------- | ---------------------------------------- |
| ALGORITHM                               | (AVERAGE) %               | SINGLE-SUPPLY VDD  + INTERNAL LDO        | DUAL-SUPPLY   VDD + VCORE                |
| Continuous HRM +  Continuous SPO2  mode | 4.7%                      | 0.74mW                                   | 0.47mW                                   |
| Continuous HRM                          | 4.3%                      | 0.68mW                                   | 0.43mW                                   |
| Sampled HRM                             | 4.3%                      | 0.68mW                                   | 0.43mW                                   |
| Activity Tracking Only                  | 4.2%                      | 0.66mW                                   | 0.42mW                                   |

*VDD: 1.8V, VCORE: 1.1V, and CPU clock: 96MHz.
